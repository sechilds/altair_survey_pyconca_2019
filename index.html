<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>reveal.js</title>

		<link rel="stylesheet" href="css/reset.css">
		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/black.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/monokai.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
		<script type="text/javascript" src="vega@5"></script>
  		<script type="text/javascript" src="vega-lite@3.4.0"></script>
        <script type="text/javascript" src="vega-embed@4"></script>
	</head>
	<body>
		<style>
			.container{
				display: flex;
				width: 1100px;
			}
			.col{
				flex: 1;
			}
			code.big {
				overflow: visible !important;
				overflow-x: visible !important;
				overflow-y: visible !important;
				background: transparent !important;
		</style>

		<div class="reveal">
			<div class="slides">
				<section><h1>Data Visualization wtih Altair</h1>
					<h2>Survey Data Case Study</h2>
					<p>Stephen Childs</p>
					<p><div class = 'container' style = 'width: 960px'><div class = "col" style='text-align:left;'>PyCon Canada 2019</div>
					<div class = "col" style='text-align:right;'>November 16, 2019</div></p>
				</section>
				<section>
					<section data-background-image="vari_flare.jpg">
						<aside class="notes">
							<h1>Context</h1>

							<p>I work at York University in the Office of
							Institutional Planning and Analysis (OIPA)
							where I survey students and analyze
							data from those surveys.</p>
							<ul>
								<li>York University - administration</li>
								<li>Need data about the university</li>
								<li>Get in student's heads</li>
								<li>Deliver better services</li>
								<li>Students are more than customers</li>
								<li>So we do surveys and collect data</li>
							</ul>
						</aside>
					</section>
					<section data-background-image="ula-kuzma-9i4DHlC80AQ-unsplash.jpg">
						<div style="height: 600px; width: 1200px;"><a style="background-color:black;
								  position: absolute;
								  bottom: 4px;
								  left: 4px;
								  color:white;
								  text-decoration:none;
								  padding:4px 6px;
								  font-family:-apple-system, BlinkMacSystemFont, &quot;San Francisco&quot;, &quot;Helvetica Neue&quot;, Helvetica, Ubuntu, Roboto, Noto, &quot;Segoe UI&quot;, Arial, sans-serif;font-size:12px;font-weight:bold;line-height:1.2;display:inline-block;border-radius:3px" href="https://unsplash.com/@ula_kuzma?utm_medium=referral&amp;utm_campaign=photographer-credit&amp;utm_content=creditBadge" target="_blank" rel="noopener noreferrer" title="Download free do whatever you want high-resolution photos from Ula Kuźma"><span style="display:inline-block;padding:2px 3px"><svg xmlns="http://www.w3.org/2000/svg" style="height:12px;width:auto;position:relative;vertical-align:middle;top:-2px;fill:white" viewBox="0 0 32 32"><title>unsplash-logo</title><path d="M10 9V0h12v9H10zm12 5h10v18H0V14h10v9h12v-9z"></path></svg></span><span style="display:inline-block;padding:2px 3px">Ula Kuźma</span></a>
						</div>
						<aside class="notes">
							<h1>Pain/Problem</h1>
							<p>Photo by Ula Kuźma on Unsplash</p>
							<br/>
							<ul>
								<li>People are busy and have a lot competing for their attention</li>
								<li>If we generate a report - people aren't going to read it</li>
								<li>Sits in a file drawer</li>
								<li>Institutional knowledge spread out across campus.</li>
								<li>survey data + instituional knowledge into action</li>
								<li>no one pours through tables of survey results for fun</li>
							</ul>
						</aside>
					</section>
					<section data-background-image='jason-coudriet-eQux_nmDew0-unsplash.jpg'>
						<div style="height: 600px; width: 1200px;"><a style="background-color:black;
								position: absolute;
								bottom: 4px;
								left: 4px;
								color:white;text-decoration:none;padding:4px 6px;font-family:-apple-system, BlinkMacSystemFont, &quot;San Francisco&quot;, &quot;Helvetica Neue&quot;, Helvetica, Ubuntu, Roboto, Noto, &quot;Segoe UI&quot;, Arial, sans-serif;font-size:12px;font-weight:bold;line-height:1.2;display:inline-block;border-radius:3px" href="https://unsplash.com/@jcoudriet?utm_medium=referral&amp;utm_campaign=photographer-credit&amp;utm_content=creditBadge" target="_blank" rel="noopener noreferrer" title="Download free do whatever you want high-resolution photos from Jason Coudriet"><span style="display:inline-block;padding:2px 3px"><svg xmlns="http://www.w3.org/2000/svg" style="height:12px;width:auto;position:relative;vertical-align:middle;top:-2px;fill:white" viewBox="0 0 32 32"><title>unsplash-logo</title><path d="M10 9V0h12v9H10zm12 5h10v18H0V14h10v9h12v-9z"></path></svg></span><span style="display:inline-block;padding:2px 3px">Jason Coudriet</span></a>
						</div>
						<aside class="notes">
							<h1>Solution: Data Visualization</h1>
						    <ul>
								<li>NSSE Dashboard got more people interested.</li>
								<li>Data viz demos well.</li>
								<li>Covers many ad hoc requests.</li>
							</ul>
							<h2>Some Notes</h2>
							<ul>
								<li>No actual YorkU survey data in presentation.</li>
								<li>Data collection and research ethics.</li>
								<li>Always be careful presenting survey data.</li>
								<li>Won't cover qualitative analysis.</li>
								<li>Python handles text analysis well.</li>
								<li>NLTK and spacy, wordcloud</li>
							</ul>
							<p>Photo by Jason Coudriet on Unsplash</p>
						</aside>
					</section>
					<section data-background-image='PIA04204.jpg'>
						<div style="height: 600px; width: 1200px;">
							<a style="background-color:black;
								position: absolute;
								bottom: 4px;
								left: 4px;
								color:white;text-decoration:none;
								padding:4px 6px;
								font-family:-apple-system, BlinkMacSystemFont, &quot;San Francisco&quot;, &quot;Helvetica Neue&quot;, Helvetica, Ubuntu, Roboto, Noto, &quot;Segoe UI&quot;, Arial, sans-serif;
								font-size:12px;
								font-weight:bold;
								line-height:1.2;
								display:inline-block;
								border-radius:3px" href="https://www.jpl.nasa.gov/spaceimages/details.php?id=PIA04204" target="_blank" rel="noopener noreferrer">
									<span style="display:inline-block;padding:2px 3px">
									<img src='nasa_logo.svg' height="20px" width="18px" style = 'border: none;'>
									</span><span style="display:inline-block;padding:2px 3px">Image Courtesy NASA</span></a>
						</div>
						<aside class="notes">
							<h1>Altair</h1>
							<p>This is Altair, as seen from NASA's
							Ultra High Resolution telescope system on
							Palomar Mountain - just outside of San Diego.
							Taken November 30, 1999.</p>

							<p>Altair is the brightest start in the
							constelation Aquila and a part of the
							Summer Triangle with Vega and Deneb.</p>

							<p>Altair is also a Python packaging
							enabling the creation of data visualizations
							using the Vega and Vega-Lite framework.</p>
							
							<p>Photo of Altair - courtesy of NASA.<p>
						</aside>
					</section>
				</section>
				<section>
					<section>
						<div id='interval_selection'></div>
						<aside class="notes">
							<h1>Altair Examples</h1>
							<p>Taken from the example gallery on the
							Altair website, which is a great way to learn
							how to use Altair.</p>
							<br/>
							<p>Altair charts are <strong>interactive</strong>.
							<ul>
								<li>Make a selection and move it around.</li>
								<li>Make a smaller selection to show dates.</li>
							</ul>
						</aside>
					</section>
					<section>
						<div id='selection_histogram'></div>
						<aside class="notes">
							<h1>Chart Selection</h1>
							<p>Another example from the website.
							Selecting a part of one graph can filter another.</p>
							<br/>
							<p>Highlight a selection and move it around.</p>
						</aside>
					</section>
				</section>
				<section>
					<div id="anscombe_all"></div>
					<aside class="notes">
						Anscome's Quartet: All four of these datasets have the
						same mean of x and y as well as the same relationship
						between x and y.
					</aside>
				</section>
				<section>
					<section>
						<div id='big_bullseye'></div>
						<aside class="notes">
							All these datasets have the same mean of x and y.
						</aside>
					</section>
					<section>
						<div id='big_star'></div>
						<aside class="notes">
							All these datasets have the same mean of x and y.
						</aside>
					</section>
					<section>
						<div id='big_x_shape'></div>
						<aside class="notes">
							All these datasets have the same mean of x and y.
						</aside>
					</section>
					<section>
						<div id='big_dino1'></div>
						<aside class="notes">
							All these datasets have the same mean of x and y.
						</aside>
					</section>
					<section>
						<div id="datasaurus_all"</div>
						<aside class="notes">
							All these datasets have the same mean of x and y.
							This is all the datasets.
							Note the way we can facet the data.
						</aside>
					</section>
				</section>
				</section>
				<section>
				<section>
					<div class="container">
						<div class = "col">
					<pre><code class='python big' data-trim>
(alt.Chart(datasaurus)
  .mark_point()
  .encode(
	x = 'x:Q',
	y = 'y:Q',
).transform_filter(
  alt.datum.dataset
    == 'dino')
)
					</code></pre>
						</div>
						<div class="col">
						<div id='small_dino1'></div>
						</div>
					</div>
					<aside class="notes">
						<h1>Grammer of Graphics: Via Altair</h1>
						<p>Altair follows the <em>Grammer of Graphics</em> approach.
						This goes back to Leland Wilkinson's 1999 book of the
						same name. There's a second edition in 2005.
						The book provides a framework for displaying graphics.
						Hadley Wickham used it for ggplot2 in the R world.</p>
						<br/>
						<p>We will walk through how it works using Altair
						examples with code and charts.</p>
					</aside>
					</section>
				<section>
					<div class="container">
						<div class = "col">
					<pre><code class='python big' data-trim data-noescape>
(alt.Chart(<mark>datasaurus</mark>)
  .mark_point()
  .encode(
	x = 'x:Q',
	y = 'y:Q',
).transform_filter(
  alt.datum.dataset
    == 'dino')
)
					</code></pre>
						</div>
						<div class="col">
						<div id='small_dino1_1'></div>
						</div>
					</div>
					<aside class="notes">
						<h1>Data</h1>
						<p>The first component is the data.
						This can be a pandas DataFrame, a file containing
						JSON or another data format or a URL pointing to
						data.</p>
						<p>You can dynamically stream data into an Altair
						visualization as long as you can serve it to a URL.</p>
					</aside>
					</section>
				<section>
					<div class="container">
						<div class = "col">
					<pre><code class='python big' data-trim data-noescape>
(alt.Chart(datasaurus)
  <mark>.mark_point()</mark>
  .encode(
	x = 'x:Q',
	y = 'y:Q',
).transform_filter(
  alt.datum.dataset
    == 'dino')
)
					</code></pre>
						</div>
						<div class="col">
						<div id='small_dino1_2'></div>
						</div>
					</div>
					<aside class="notes">
						<h1>Marks</h1>
						<p>There are several types of Marks in Altair.
						They represent the data.</p>
						<ul>
							<li>area</li>
							<li>bar</li>
							<li>circle</li>
							<li>geoshape</li>
							<li>line</li>
							<li>point</li>
							<li>rect</li>
							<li>rule</li>
							<li>square</li>
							<li>text</li>
							<li>tick</li>
						</ul>
						<p>You an only have 1 type of mark per chart object.</p>
						<p>That seems like a limitation, but wait...</p>
					</aside>
					</section>
				<section>
					<div class="container">
						<div class = "col">
					<pre><code class='python big' data-trim data-noescape>
(alt.Chart(datasaurus)
  .mark_point()
  .encode(
	<mark>x = 'x:Q',</mark>
	<mark>y = 'y:Q',</mark>
).transform_filter(
  alt.datum.dataset
    == 'dino')
)
					</code></pre>
						</div>
						<div class="col">
						<div id='small_dino1_3'></div>
						</div>
					</div>
					<aside class="notes">
						<h1>Encoding Channels</h1>
						<p>This makes the link from the data to the mark.
						These can be position (x, y) or other features
						like colour, shape, size or even text.</p>
						<br/>
						<p>They can be associated with any variable in
						the dataset or a calcuation.</p>
						<br/>
						<p>The Q's representative quantitative data and
						will affect how the data is displayed. There is
						also Nominal, Ordinal or temporal data.</p>
					</aside>
					</section>
				<section>
					<div class="container">
						<div class = "col">
					<pre><code class='python big' data-trim data-noescape>
(alt.Chart(datasaurus)
  .mark_point()
  .encode(
	x = 'x:Q',
	y = 'y:Q',
)<mark>.transform_filter(</mark>
 <mark> alt.datum.dataset</mark>
   <mark>== 'dino')</mark>
)
					</code></pre>
						</div>
						<div class="col">
						<div id='small_dino1_4'></div>
						</div>
					</div>
					<aside class="notes">
						<h1>Transformation.</h1>
						<p>In this case filtering
						the dataset. There are lots of options for
						transforming data.</p>
						<br/>
						<p>You can create new fields with a calculation,
						aggregate data, group data by fields and more.</p>
					</aside>
					</section>
					<section>
					<div class="container">
						<div class = "col">
					<pre><code class='python big' data-trim data-noescape>
from vega_datasets \
  import data

movies = data.movies.url

alt.Chart(movies
).mark_bar(
).encode(
  alt.X("IMDB_Rating:Q",
	<mark>bin=True</mark>),
  y='count()',
)
					</code></pre>
						</div>
						<div class="col">
						<div id='bin'></div>
						</div>
					</div>
					<aside class="notes">
						<h1>Binning</h1>
						<p>One of the transformations in Altair. This is how
						you create a Histogram.</p>
						<br/>
						<p>Note the alt.X() function. That wraps an encoding
						channel to let you specify options.</p>
					</aside>
					</section>
					<section>
					<div class="container">
						<div class = "col">
					<pre><code class='python big' data-trim data-noescape>
from vega_datasets \
  import data

cars = data.cars.url

alt.Chart(cars
).mark_bar(
).encode(
  y='Cylinders:O',
  x=<mark>'mean(Acceleration):Q'</mark>
)
					</code></pre>
						</div>
						<div class="col">
						<div id='mean'></div>
						</div>
					</div>
					<aside class="notes">
						<h1>Aggregation</h1>
						<p>Altair can take the mean across groups of
						your data. Here it takes the mean acceleration
						of the cars in this dataset, grouped by
						the Cylinders.</p>
					</aside>
					</section>
					<section>
					<div class="container">
						<div class = "col">
					<pre><code class='python big' data-trim data-noescape>
alt.Chart(datasaurus
).mark_point(
).encode(
  x='x:Q',
  y='y:Q',
  color='dataset:N',
).<mark>facet(</mark>
	<mark>'dataset:N',</mark>
	<mark>columns = 2</mark>
<mark>)</mark>
					</code></pre>
						</div>
						<div class="col">
						<div id='datasaurus_small'></div>
						</div>
					</div>
					<aside class="notes">
						<h1>Facets</h1>
						<p>The grammer of graphics embraces small multiples and
						lets you quickly generate graphs of subsets of the data.
						This is a fast way to examine datasets.
					</aside>
					</section>
					<section>
					<div class="container">
						<div class = "col">
					<pre><code class='python big' data-trim data-noescape>
source = data.movies.url

heatmap = alt.Chart(source
).mark_rect().encode(
  alt.X('IMDB_Rating:Q',
    bin=True),
  alt.Y('Rotten_Tomatoes_Rating:Q',
    bin=True),
  alt.Color('count()')
 )
 
 points = alt.Chart(source
 ).mark_circle(
   color='white',
   size=5,
 ).encode(
   x='IMDB_Rating:Q',
   y='Rotten_Tomatoes_Rating:Q'
 )

 <mark>heatmap + points</mark>
					</code></pre>
						</div>
						<div class="col">
						<div id='layers'></div>
						</div>
					</div>
					<aside class="notes">
						<h1>Layers</h1>
						<p>Remember only one mark per chart. This is
						how you get around that - by layering charts.</p>
						<br/>
						<p>These are layered on top of each other.
						Later levels obscure earlier ones.</p>
						<br/>
						<p>Mention interaction between facets
						and layers. Layer first then facet.</p>
					</aside>
					</section>
				</section>
				<section>
					<section>
						<pre><code class="json big">
{"data": {"name": "data-525eaa47413d8b78972b8b2e3334f770"},
 "mark": "point",
 "encoding":
   {"x": {"type": "quantitative", "field": "x"},
    "y": {"type": "quantitative", "field": "y"}},
 "transform": [{"filter": "(datum.dataset === 'dino')"}],
 "$schema": "https://vega.github.io/schema/vega-lite/v3.4.0.json"
}
						</code></pre>
						<aside class="notes">
							<h1>How Altair Works</h1>
							<p>Altair is built upon Vega-Lite, which
							is a javascript library that renders
							JSON into a chart. The Altair Chart object
							produces that JSON, which looks like this.</p>
							<br/>
							<p>This will render automatially in a Jupyter
							Notebook and it can be added to a web page.
							</p>
						</aside>
					</section>
					<section>
						<pre> <code class="html big">
<div id='big_dino1'></div>
						</code></pre>
						<pre class = 'fragment'> <code class="javascript big">
var spec = 'big_dino1.json';
vegaEmbed('#big_dino1', spec).then(
  function(result) {}).catch(console.error);
						</code></pre>
						<aside class="notes">
							<h1>Embed in a Web Page</h1>
							<p>To insert a chart, you put a div where you want
							the chart to be.</p>
							<br/>
							<p><strong>CLICK.</strong>
							Now add this big of javascript to get vega to add
							the chart (either a canvas or svg element) to that
							div. You can load it from a file or specify the
							JSON right there.</p>
						</aside>
					</section>
					<section>
						<pre> <code class="javascript big">
vegaEmbed('#big_dino1',
  source={{ include_file('big_dino1.json') }}).then(
  function(result) {}).catch(console.error);
						</code></pre>
						<aside class = "notes">
							<p>If you want to distribute your charts in a
							single HTML file, you can use jinja2 to
							embed the JSON directly in the web page.</p>
						</aside>
					</section>
				</section>
				<section>
					<section>
						<table border="1" class="dataframe" style="font-size: 25px;">
							  <thead>
								<tr style="text-align: right;">
								  <th></th>
								  <th>id</th>
								  <th>satisfaction_v2</th>
								  <th>Gender</th>
								  <th>...</th>
								  <th>Online boarding</th>
								  <th>Departure Delay in Minutes</th>
								  <th>Arrival Delay in Minutes</th>
								</tr>
							  </thead>
							  <tbody>
								<tr>
								  <th>0</th>
								  <td>11112</td>
								  <td>satisfied</td>
								  <td>Female</td>
								  <td>...</td>
								  <td>2</td>
								  <td>0</td>
								  <td>0.0</td>
								</tr>
								<tr>
								  <th>1</th>
								  <td>110278</td>
								  <td>satisfied</td>
								  <td>Male</td>
								  <td>...</td>
								  <td>2</td>
								  <td>310</td>
								  <td>305.0</td>
								</tr>
								<tr>
								  <th>2</th>
								  <td>103199</td>
								  <td>satisfied</td>
								  <td>Female</td>
								  <td>...</td>
								  <td>2</td>
								  <td>0</td>
								  <td>0.0</td>
								</tr>
								<tr>
								  <th>3</th>
								  <td>47462</td>
								  <td>satisfied</td>
								  <td>Female</td>
								  <td>...</td>
								  <td>3</td>
								  <td>0</td>
								  <td>0.0</td>
								</tr>
								<tr>
								  <th>...</th>
								  <td>...</td>
								  <td>...</td>
								  <td>...</td>
								  <td>...</td>
								  <td>...</td>
								  <td>...</td>
								  <td>...</td>
								</tr>
								<tr>
								  <th>129876</th>
								  <td>97768</td>
								  <td>neutral or dissatisfied</td>
								  <td>Male</td>
								  <td>...</td>
								  <td>1</td>
								  <td>174</td>
								  <td>172.0</td>
								</tr>
								<tr>
								  <th>129877</th>
								  <td>125368</td>
								  <td>neutral or dissatisfied</td>
								  <td>Male</td>
								  <td>...</td>
								  <td>2</td>
								  <td>155</td>
								  <td>163.0</td>
								</tr>
								<tr>
								  <th>129878</th>
								  <td>251</td>
								  <td>neutral or dissatisfied</td>
								  <td>Male</td>
								  <td>...</td>
								  <td>2</td>
								  <td>193</td>
								  <td>205.0</td>
								</tr>
								<tr>
								  <th>129879</th>
								  <td>84566</td>
								  <td>neutral or dissatisfied</td>
								  <td>Female</td>
								  <td>...</td>
								  <td>3</td>
								  <td>185</td>
								  <td>186.0</td>
								</tr>
							  </tbody>
							</table>
							<aside class="notes">
								<h1>Survey Data</h1>
								<p>Now we turn to survey data.</p>
								<ul>
									<li>Survey data in it's raw form.</li>
									<li>Row are individual respondents.</li>
									<li>Columns are questions or characteritics of
										the respondent.</li>
									<li>Survey of airline customers.</li>
								</ul>
							</aside>
					</section>
					<section>
						<pre><code class='python big' data-trim>
uc = df.nunique().reset_index()
uc.columns = ['field', 'count']
alt.Chart(uc).mark_bar().encode(
	y='field:N',
	x='count:Q'
)
						</code></pre>
						<aside class="notes">
							<h1>Start to Visualize</h1>
							<p>The first thing we to with our data is
							to visualize it in various ways to learn a
							bit about it.</p>
							<br/>
							<p>This gets the count of unique values for
							each column, create that dataset and
							then creates a bar chart.</p>
						</aside>
					</section>
					<section>
						<div id='unique_count1'>,/div>
						<aside class="notes">
							<p>Id, which is a unique identifier blows
							out this chart. But this lets us see
							right away that we have a unique identifier
							and what it's name is.</p>
						</aside>
					</section>
					<section>
						<pre><code class='python big' data-trim>
alt.Chart(uc).mark_bar().encode(
	y='field:N',
	x='count:Q'
).transform_filter(alt.datum.count < 1000)
						</code></pre>
						<aside class="notes">
							<p>Now let's restrict our Chart to only
							those variables with less than 1000
							unique values. This is really easy to do
							in Altair - you filter the data.<p>
							<br/>
							<p>The datum object lets you refer back
							to the chart's data.</p>
						</aside>
					</section>
					<section>
						<div id='unique_count2'></div>
						<aside class="notes">
							<p>Now we see a few items with large
							unique counts - Age and Duration of
							Flight as well as delay times. That
							probably indicates that they are
							quantitative data.</p>
							<br/>
							<p>We can tell that this is probably
							data taken from the airline and not
							directly asked each customer. They
							will know the birth date for each
							customer + details about their flight.</p>
						</aside>
					</section>
					<section>
						<pre><code class='python big' data-trim>
alt.Chart(uc).mark_bar().encode(
	y='field:N',
	x='count:Q'
).transform_filter(alt.datum.count < 10)
						</code></pre>
						<aside class="notes">
							<p>Now let's reduce this to fields with
							less than 10 unique values.</p>
						</aside>
					</section>
					<section>
						<div id='unique_count3'></div>
						<aside class="notes">
							<p>Now we can see a bunch of fields with
							5 or 6 responses -- these are the scale
							questions rating various aspects of the
							flight.</p>
							<br/>
							<p>The rest are categorial variables,
							characteristics of the traveller.</p>
						</aside>
					</section>
					</section>
					<section>
					<section>
						<table border="1" class="dataframe" style="font-size: 25px;">
							  <thead>
								<tr style="text-align: right;">
								  <th></th>
								  <th>id</th>
								  <th>satisfaction_v2</th>
								  <th>Gender</th>
								  <th>...</th>
								  <th>Online boarding</th>
								  <th>Departure Delay in Minutes</th>
								  <th>Arrival Delay in Minutes</th>
								</tr>
							  </thead>
							  <tbody>
								<tr>
								  <th>0</th>
								  <td>11112</td>
								  <td>satisfied</td>
								  <td>Female</td>
								  <td>...</td>
								  <td>2</td>
								  <td>0</td>
								  <td>0.0</td>
								</tr>
								<tr>
								  <th>1</th>
								  <td>110278</td>
								  <td>satisfied</td>
								  <td>Male</td>
								  <td>...</td>
								  <td>2</td>
								  <td>310</td>
								  <td>305.0</td>
								</tr>
								<tr>
								  <th>2</th>
								  <td>103199</td>
								  <td>satisfied</td>
								  <td>Female</td>
								  <td>...</td>
								  <td>2</td>
								  <td>0</td>
								  <td>0.0</td>
								</tr>
								<tr>
								  <th>3</th>
								  <td>47462</td>
								  <td>satisfied</td>
								  <td>Female</td>
								  <td>...</td>
								  <td>3</td>
								  <td>0</td>
								  <td>0.0</td>
								</tr>
								<tr>
								  <th>...</th>
								  <td>...</td>
								  <td>...</td>
								  <td>...</td>
								  <td>...</td>
								  <td>...</td>
								  <td>...</td>
								  <td>...</td>
								</tr>
								<tr>
								  <th>129876</th>
								  <td>97768</td>
								  <td>neutral or dissatisfied</td>
								  <td>Male</td>
								  <td>...</td>
								  <td>1</td>
								  <td>174</td>
								  <td>172.0</td>
								</tr>
								<tr>
								  <th>129877</th>
								  <td>125368</td>
								  <td>neutral or dissatisfied</td>
								  <td>Male</td>
								  <td>...</td>
								  <td>2</td>
								  <td>155</td>
								  <td>163.0</td>
								</tr>
								<tr>
								  <th>129878</th>
								  <td>251</td>
								  <td>neutral or dissatisfied</td>
								  <td>Male</td>
								  <td>...</td>
								  <td>2</td>
								  <td>193</td>
								  <td>205.0</td>
								</tr>
								<tr>
								  <th>129879</th>
								  <td>84566</td>
								  <td>neutral or dissatisfied</td>
								  <td>Female</td>
								  <td>...</td>
								  <td>3</td>
								  <td>185</td>
								  <td>186.0</td>
								</tr>
							  </tbody>
							</table>
							<aside class="notes">
								Survey data in it's raw form.
								Row are individual respondents.
								Columns are questions or characteritics of
								the respondent.
							</aside>
					</section>
					<section>
						<pre><code class='python big' data-trim data-noescape>
long_data = (df.set_index('id')
  <mark>.stack()</mark>
  .reset_index()
  .pipe(setcols,
     cols = ['id',
      'field_name',
      'response'])
  .set_index('id')
)
						</code></pre>
						<pre class = 'fragment'><code class='python big' data-trim>
long_data = pd.merge(long_data,
  df,
  how = 'inner',
  left_index = True,
  right_index = True)
					 	</code></pre>
						<aside class="notes">
							We transform the data with <code>stack</code>.
							We merge in the original dataset so
							we now have all answers and characteristics
							available to fitler on.
						</aside>
					</section>
					<section>
							<table border="1" class="dataframe", style="font-size: 25px;">
							  <thead>
								<tr style="text-align: right;">
								  <th></th>
								  <th>id</th>
								  <th>field_name</th>
								  <th>response</th>
								  <th>...</th>
								  <th>Online boarding</th>
								  <th>Departure Delay in Minutes</th>
								  <th>Arrival Delay in Minutes</th>
								</tr>
							  </thead>
							  <tbody>
								<tr>
								  <th>0</th>
								  <td>1</td>
								  <td>Seat comfort</td>
								  <td>3</td>
								  <td>...</td>
								  <td>5</td>
								  <td>2</td>
								  <td>5.0</td>
								</tr>
								<tr>
								  <th>1</th>
								  <td>1</td>
								  <td>Departure/Arrival time convenient</td>
								  <td>3</td>
								  <td>...</td>
								  <td>5</td>
								  <td>2</td>
								  <td>5.0</td>
								</tr>
								<tr>
								  <th>2</th>
								  <td>1</td>
								  <td>Food and drink</td>
								  <td>3</td>
								  <td>...</td>
								  <td>5</td>
								  <td>2</td>
								  <td>5.0</td>
								</tr>
								<tr>
								  <th>3</th>
								  <td>1</td>
								  <td>Gate location</td>
								  <td>3</td>
								  <td>...</td>
								  <td>5</td>
								  <td>2</td>
								  <td>5.0</td>
								</tr>
								<tr>
								  <th>...</th>
								  <td>...</td>
								  <td>...</td>
								  <td>...</td>
								  <td>...</td>
								  <td>...</td>
								  <td>...</td>
								  <td>...</td>
								</tr>
								<tr>
								  <th>1818316</th>
								  <td>129880</td>
								  <td>Baggage handling</td>
								  <td>4</td>
								  <td>...</td>
								  <td>3</td>
								  <td>0</td>
								  <td>0.0</td>
								</tr>
								<tr>
								  <th>1818317</th>
								  <td>129880</td>
								  <td>Checkin service</td>
								  <td>5</td>
								  <td>...</td>
								  <td>3</td>
								  <td>0</td>
								  <td>0.0</td>
								</tr>
								<tr>
								  <th>1818318</th>
								  <td>129880</td>
								  <td>Cleanliness</td>
								  <td>4</td>
								  <td>...</td>
								  <td>3</td>
								  <td>0</td>
								  <td>0.0</td>
								</tr>
								<tr>
								  <th>1818319</th>
								  <td>129880</td>
								  <td>Online boarding</td>
								  <td>3</td>
								  <td>...</td>
								  <td>3</td>
								  <td>0</td>
								  <td>0.0</td>
								</tr>
							  </tbody>
							</table>
							<aside class = "notes">
								The transformed data. Note how the <code>id</code>
								field is repeated in multiple rows.
								Because we merged in the table -- we now
								have the same fields we had in the first table.
							</aside>
					</section>
					<section>
						<pre><code class = "python big" data-trim>
counts = df.groupby(['field_name', 'response'])['id'].count()
freq = counts.groupby(level=0).apply(lambda x : x / float(s.sum()))
counts = pd.concat([counts, freq], axis = 1)
counts.columns = ['count', 'freq']
counts.reset_index()
						</code></pre>
					</section>
					<section>
						<pre><code class = "python big" data-trim>
filters = ['Gender', 'Customer Type', 'Type of Travel', 'Class']
						</code></pre>
						<pre><code class = "python big fragment" data-trim>
def all_combinations(any_list):
  return chain.from_iterable(
    combinations(any_list, i) for i in range(len(any_list)+1))
						</code></pre>
						<pre><code class = "python big fragment" data-trim>
combos = (count_data(counts,
  group_fields = list(i))
  for i in all_combinations(filters))
						</code></pre>
						<pre><code class = "python big fragment" data-trim>
pd.concat(combos, axis = 0, sort = False)
						</code></pre>
						<aside class = "notes">
							<h1> Aggregation</h1>
							We group first by field_name and response to
							get the count of the responses.
							The second group by calculates the percentage.
							You can add additional fields to the groupby
							to do the same process for subgroups.

							You can also do other calculations - like
							statistics. (Beyond the scope here.)
						</aside>
					</section>
					<section>
						<table border="1" class="dataframe" style="font-size: 25px;">
								  <thead>
									<tr style="text-align: right;">
									  <th></th>
									  <th>field_name</th>
									  <th>response</th>
									  <th>count</th>
									  <th>freq</th>
									  <th>Gender</th>
									  <th>Customer Type</th>
									  <th>Type of Travel</th>
									  <th>Class</th>
									</tr>
								  </thead>
								  <tbody>
									<tr>
									  <th>0</th>
									  <td>Baggage handling</td>
									  <td>1</td>
									  <td>7975</td>
									  <td>0.061403</td>
									  <td>All</td>
									  <td>All</td>
									  <td>All</td>
									  <td>All</td>
									</tr>
									<tr>
									  <th>1</th>
									  <td>Baggage handling</td>
									  <td>2</td>
									  <td>13432</td>
									  <td>0.103419</td>
									  <td>All</td>
									  <td>All</td>
									  <td>All</td>
									  <td>All</td>
									</tr>
									<tr>
									  <th>2</th>
									  <td>Baggage handling</td>
									  <td>3</td>
									  <td>24485</td>
									  <td>0.188520</td>
									  <td>All</td>
									  <td>All</td>
									  <td>All</td>
									  <td>All</td>
									</tr>
									<tr>
									  <th>3</th>
									  <td>Baggage handling</td>
									  <td>4</td>
									  <td>48240</td>
									  <td>0.371420</td>
									  <td>All</td>
									  <td>All</td>
									  <td>All</td>
									  <td>All</td>
									</tr>
									<tr>
									  <th>...</th>
									  <td>...</td>
									  <td>...</td>
									  <td>...</td>
									  <td>...</td>
									  <td>...</td>
									  <td>...</td>
									  <td>...</td>
									  <td>...</td>
									</tr>
									<tr>
									  <th>8168</th>
									  <td>Seat comfort</td>
									  <td>1</td>
									  <td>1</td>
									  <td>0.250000</td>
									  <td>Male</td>
									  <td>disloyal Customer</td>
									  <td>Personal Travel</td>
									  <td>Eco Plus</td>
									</tr>
									<tr>
									  <th>8169</th>
									  <td>Seat comfort</td>
									  <td>2</td>
									  <td>1</td>
									  <td>0.250000</td>
									  <td>Male</td>
									  <td>disloyal Customer</td>
									  <td>Personal Travel</td>
									  <td>Eco Plus</td>
									</tr>
									<tr>
									  <th>8170</th>
									  <td>Seat comfort</td>
									  <td>3</td>
									  <td>1</td>
									  <td>0.250000</td>
									  <td>Male</td>
									  <td>disloyal Customer</td>
									  <td>Personal Travel</td>
									  <td>Eco Plus</td>
									</tr>
									<tr>
									  <th>8171</th>
									  <td>Seat comfort</td>
									  <td>4</td>
									  <td>1</td>
									  <td>0.250000</td>
									  <td>Male</td>
									  <td>disloyal Customer</td>
									  <td>Personal Travel</td>
									  <td>Eco Plus</td>
									</tr>
								  </tbody>
								</table>
					</section>
					</section>
					<section>
					<section>
						<div class = "container">
							<div class = "col">
								<pre><code class = "python big" data-trim>
alt.Chart(df).mark_bar(
).encode(
  x = 'count:Q',
  y = 'response:N',
  fill = 'response:N'
).facet(
  row = 'field_name:N'
)
								</pre></code>
							</div>
							<div class = "col">
								<div id='div_bar1'></div>
							</div>
					</section>
					<section>
						<div class = "container">
							<div class = "col">
								<pre><code class = "python big" data-trim>
alt.Chart(df).mark_bar(
).encode(
  x = 'freq:Q',
  y = 'response:N',
  fill = 'response:N'
).facet(
  row = 'field_name:N'
)
								</pre></code>
							</div>
							<div class = "col"
								<div id='div_bar2'></div>
							</div>
					</section>
					<section>
						<div class = "container">
							<div class = "col">
								<pre><code class = "python big" data-trim>
df['end_percent'] = (
  df.groupby('field_name')
  ['freq'].cumsum()
)

alt.Chart(df).mark_bar(
).encode(
  x = 'end_precent:Q',
  y = 'response:N',
  fill = 'response:N'
).facet(
  row = 'field_name:N'
)
								</pre></code>
							</div>
							<div class = "col"
								<div id='div_bar3'></div>
							</div>
					</section>
					<section>
						<div class = "container">
							<div class = "col">
								<pre><code class = "python big" data-trim>
df['start_percent'] = (
  df.groupby('field_name')
  ['end_percent'].shift(1).
  fillna(0)
)

alt.Chart(df).mark_bar(
).encode(
  x = 'start_percent:Q',
  x2 = 'end_precent:Q',
  y = 'response:N',
  fill = 'response:N'
).facet(
  row = 'field_name:N'
)
								</pre></code>
							</div>
							<div class = "col"
								<div id='div_bar4'></div>
							</div>
					</section>
					<section>
						<div class = "container">
							<div class = "col">
								<pre><code class = "python big" data-trim>
alt.Chart(df).mark_bar(
).encode(
  x = 'start_percent:Q',
  x2 = 'end_precent:Q',
  fill = 'response:N'
).facet(
  row = 'field_name:N'
)
								</pre></code>
							</div>
							<div class = "col"
								<div id='div_bar5'></div>
							</div>
					</section>
					<section>
						<div class = "container">
							<div class = "col">
								<pre><code class = "python big" data-trim style = 'width: 300px; height: 600px; overflow-x: visible; overflow-y: visible;'>
(df['negative'] = 
  df['response']
  .apply(lambda x :
    True if x < 3
    else False)
)
(starting_point = 
  df[df.negative]
  .groupby('field_name')
    ['freq'].sum())

(res[['start_percent',
     'end_percent']] -
  starting_point)

alt.Chart(df).mark_bar(
).encode(
  x = 'start_percent:Q',
  x2 = 'end_precent:Q',
  fill = 'response:N'
).facet(
  row = 'field_name:N'
)
								</pre></code>
							</div>
							<div class = "col"
								<div id='div_bar6'></div>
							</div>
					</section>
					</section>
					<section>
						<div id='dashboard2'></div>
					</section>
			</div>
		</div>

		<script src="js/reveal.js"></script>

	<script type="text/javascript">
		var spec = 'big_dino1.json';
		var theme = {
			range: {
				category: {
					scheme: "dark2"
				}
			}
		};
		var opt = {theme: 'dark',
			       renderer: 'svg',
			       tooltip: false,
			       hover: false,
				   actions: false}
		var opt2 = {theme: 'dark',
			       renderer: 'svg',
			       tooltip: false,
			       hover: true,
				   actions: false}
vegaEmbed('#big_dino1', spec, opt).then(function(result) {}).catch(console.error);
	</script>

	<script type="text/javascript">
		var spec = 'big_away.json';
		vegaEmbed('#big_away', spec, opt).then(function(result) {}).catch(console.error);
	</script>

	<script type="text/javascript">
		var spec = 'big_bullseye.json';
		vegaEmbed('#big_bullseye', spec, opt).then(function(result) {}).catch(console.error);
	</script>

	<script type="text/javascript">
		var spec = 'big_circle.json';
		vegaEmbed('#big_circle', spec, opt).then(function(result) {}).catch(console.error);
	</script>

	<script type="text/javascript">
		var spec = 'big_dots.json';
		vegaEmbed('#big_dots', spec, opt).then(function(result) {}).catch(console.error);
	</script>

	<script type="text/javascript">
		var spec = 'big_h_lines.json';
		vegaEmbed('#big_h_lines', spec, opt).then(function(result) {}).catch(console.error);
	</script>

	<script type="text/javascript">
		var spec = 'big_high_lines.json';
		vegaEmbed('#big_high_lines', spec, opt).then(function(result) {}).catch(console.error);
	</script>

	<script type="text/javascript">
		var spec = 'big_slant_down.json';
		vegaEmbed('#big_slant_down', spec, opt).then(function(result) {}).catch(console.error);
	</script>

	<script type="text/javascript">
		var spec = 'big_slant_up.json';
		vegaEmbed('#big_slant_up', spec, opt).then(function(result) {}).catch(console.error);
	</script>

	<script type="text/javascript">
		var spec = 'big_star.json';
		vegaEmbed('#big_star', spec, opt).then(function(result) {}).catch(console.error);
	</script>

	<script type="text/javascript">
		var spec = 'big_v_lines.json';
		vegaEmbed('#big_v_lines', spec, opt).then(function(result) {}).catch(console.error);
	</script>

	<script type="text/javascript">
		var spec = 'big_wide_lines.json';
		vegaEmbed('#big_wide_lines', spec, opt).then(function(result) {}).catch(console.error);
	</script>

	<script type="text/javascript">
		var spec = 'big_x_shape.json';
		vegaEmbed('#big_x_shape', spec, opt).then(function(result) {}).catch(console.error);
	</script>

	<script type="text/javascript">
		var spec = 'small_dino1.json';
		vegaEmbed('#small_dino1', spec, opt).then(function(result) {}).catch(console.error);
	</script>
	<script type="text/javascript">
		var spec = 'small_dino1.json';
		vegaEmbed('#small_dino1_1', spec, opt).then(function(result) {}).catch(console.error);
	</script>

	<script type="text/javascript">
		var spec = 'small_dino1.json';
		vegaEmbed('#small_dino1_2', spec, opt).then(function(result) {}).catch(console.error);
	</script>
	<script type="text/javascript">
		var spec = 'small_dino1.json';
		vegaEmbed('#small_dino1_3', spec, opt).then(function(result) {}).catch(console.error);
	</script>
	<script type="text/javascript">
		var spec = 'small_dino1.json';
		vegaEmbed('#small_dino1_4', spec, opt).then(function(result) {}).catch(console.error);
	</script>
	<script type="text/javascript">
		var spec = 'bin.json';
		vegaEmbed('#bin', spec, opt).then(function(result) {}).catch(console.error);
	</script>
	<script type="text/javascript">
		var spec = 'mean.json';
		vegaEmbed('#mean', spec, opt).then(function(result) {}).catch(console.error);
	</script>
	<script type="text/javascript">
		var spec = 'datasaurus_small.json';
		vegaEmbed('#datasaurus_small', spec, opt).then(function(result) {}).catch(console.error);
	</script>
	<script type="text/javascript">
		var spec = 'layers.json';
		vegaEmbed('#layers', spec, opt).then(function(result) {}).catch(console.error);
	</script>
	<script type="text/javascript">
		var spec = 'anscombe_all.json';
		vegaEmbed('#anscombe_all', spec, opt).then(function(result) {}).catch(console.error);
	</script>

	<script type="text/javascript">
		var spec = 'datasaurus_all.json';
		vegaEmbed('#datasaurus_all', spec, opt).then(function(result) {}).catch(console.error);
	</script>

	<script type="text/javascript">
		var spec = 'unique_count1.json';
		vegaEmbed('#unique_count1', spec, opt).then(function(result) {}).catch(console.error);
	</script>
	<script type="text/javascript">
		var spec = 'unique_count2.json';
		vegaEmbed('#unique_count2', spec, opt).then(function(result) {}).catch(console.error);
	</script>
	<script type="text/javascript">
		var spec = 'unique_count3.json';
		vegaEmbed('#unique_count3', spec, opt).then(function(result) {}).catch(console.error);
	</script>
	<script type="text/javascript">
		var spec = 'div_bar1.json';
		vegaEmbed('#div_bar1', spec, opt).then(function(result) {}).catch(console.error);
	</script>
	<script type="text/javascript">
		var spec = 'div_bar2.json';
		vegaEmbed('#div_bar2', spec, opt).then(function(result) {}).catch(console.error);
	</script>
	<script type="text/javascript">
		var spec = 'div_bar3.json';
		vegaEmbed('#div_bar3', spec, opt).then(function(result) {}).catch(console.error);
	</script>
	<script type="text/javascript">
		var spec = 'div_bar4.json';
		vegaEmbed('#div_bar4', spec, opt).then(function(result) {}).catch(console.error);
	</script>
	<script type="text/javascript">
		var spec = 'div_bar5.json';
		vegaEmbed('#div_bar5', spec, opt).then(function(result) {}).catch(console.error);
	</script>
	<script type="text/javascript">
		var spec = 'div_bar6.json';
		vegaEmbed('#div_bar6', spec, opt).then(function(result) {}).catch(console.error);
	</script>
	<script type="text/javascript">
		var spec = 'interval_selection.json';
		vegaEmbed('#interval_selection', spec, opt2).then(function(result) {}).catch(console.error);
	</script>
	<script type="text/javascript">
		var spec = 'selection_histogram.json';
		vegaEmbed('#selection_histogram', spec, opt2).then(function(result) {}).catch(console.error);
	</script>
	<script type="text/javascript">
		var spec = 'dashboard2.json';
		vegaEmbed('#dashboard2', spec, opt2).then(function(result) {}).catch(console.error);
	</script>
		<script>
			// More info about config & dependencies:
			// - https://github.com/hakimel/reveal.js#configuration
			// - https://github.com/hakimel/reveal.js#dependencies
			Reveal.initialize({
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true }
				]
			});
		</script>
	</body>
</html>
